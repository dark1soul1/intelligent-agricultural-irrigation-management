# AI助手 - 慧宝 使用说明

## 概述

慧宝是一个基于DeepSeek API的智能农业灌溉系统AI助手，集成在系统界面中，为用户提供专业的农业灌溉咨询和技术支持。

## 功能特点

### 🎯 专业领域
- 农业灌溉系统技术咨询
- 灌溉设备使用指导
- 灌溉计划制定建议
- 土壤环境因素分析
- 节水灌溉最佳实践

### 🎨 界面特色
- 可爱的虚拟形象（慧宝）
- 悬停提示交互
- 实时流式对话
- 美观的聊天界面
- 响应式设计

### 💬 对话功能
- 智能问答
- 上下文记忆
- 流式响应
- 会话管理
- 历史记录

## 安装和启动

### 1. 安装Python依赖

```bash
pip install asyncio httpx websockets
```

### 2. 启动AI服务器

在 `portal` 目录下运行：

```bash
python ai_server.py
```

启动成功后，您会看到类似以下输出：

```
2024-01-01 12:00:00 - INFO - AI助手服务器启动中...
2024-01-01 12:00:00 - INFO - WebSocket服务地址: ws://0.0.0.0:8001
2024-01-01 12:00:00 - INFO - API配置: https://api.deepseek.com/v1/chat/completions
2024-01-01 12:00:00 - INFO - ✅ AI助手服务器启动成功！
2024-01-01 12:00:00 - INFO - 📡 监听地址: ws://0.0.0.0:8001
2024-01-01 12:00:00 - INFO - 🤖 虚拟助手: 慧宝
2024-01-01 12:00:00 - INFO - 🌱 专业领域: 农业灌溉系统
2024-01-01 12:00:00 - INFO - 按 Ctrl+C 停止服务器
```

### 3. 启动前端应用

在另一个终端中启动前端应用：

```bash
npm run dev
```

## 使用方法

### 基本交互

1. **悬停提示**：将鼠标悬停在右下角的慧宝头像上，会显示"点击和我聊天吧！"的提示
2. **开始对话**：点击慧宝头像打开对话窗口
3. **发送消息**：在输入框中输入问题，点击"发送"按钮或按 `Ctrl+Enter`
4. **查看回复**：AI会以流式方式实时显示回复内容

### 对话示例

**用户**：什么是智能灌溉系统？

**慧宝**：智能灌溉系统是一种现代化的农业灌溉技术，它通过传感器、控制器和自动化设备来实现精准、高效的灌溉管理。主要特点包括：

1. **自动化控制**：根据土壤湿度、温度等环境参数自动调节灌溉
2. **精准灌溉**：针对不同作物和生长阶段提供精确的水量控制
3. **节水环保**：减少水资源浪费，提高灌溉效率
4. **远程监控**：支持手机APP或网页端远程监控和控制

**用户**：如何选择合适的灌溉设备？

**慧宝**：选择合适的灌溉设备需要考虑以下几个因素：

1. **作物类型**：不同作物对水分需求不同
2. **土壤条件**：土壤类型影响水分渗透和保持能力
3. **气候环境**：降雨量、蒸发量等气候因素
4. **经济预算**：设备成本和维护费用

常见的灌溉设备包括：
- 滴灌系统：适合果树、蔬菜等经济作物
- 喷灌系统：适合大田作物和草坪
- 微喷系统：适合温室和精细农业

## 技术架构

### 前端组件
- **AIAssistant.vue**：AI助手主组件
- **虚拟形象**：基于 `mascot-huibao.png`
- **WebSocket通信**：实时双向通信
- **流式响应**：实时显示AI回复

### 后端服务
- **Python WebSocket服务器**：处理客户端连接
- **DeepSeek API集成**：调用AI模型
- **会话管理**：维护对话历史
- **错误处理**：完善的异常处理机制

### 通信协议
```json
// 客户端发送消息
{
  "session_id": "session_1234567890_abc123",
  "message": "用户输入的问题"
}

// 服务器响应
{
  "delta": "流式文本片段"
}

// 完成标志
{
  "done": true
}

// 错误信息
{
  "error": "错误描述"
}
```

## 配置说明

### API配置
在 `ai_server.py` 中修改以下配置：

```python
API_KEY = "your-deepseek-api-key"  # DeepSeek API密钥
API_URL = "https://api.deepseek.com/v1/chat/completions"  # API地址
```

### 服务器配置
```python
host = "0.0.0.0"  # 监听地址
port = 8001       # 监听端口
```

### 前端配置
在 `AIAssistant.vue` 中修改WebSocket连接地址：

```javascript
const ws = new WebSocket('ws://localhost:8001')  // WebSocket地址
```

## 故障排除

### 常见问题

1. **连接失败**
   - 检查AI服务器是否启动
   - 确认端口8001未被占用
   - 检查防火墙设置

2. **API调用失败**
   - 验证API密钥是否正确
   - 检查网络连接
   - 确认API配额是否充足

3. **虚拟形象不显示**
   - 检查图片文件路径
   - 确认文件格式为PNG
   - 检查浏览器控制台错误

### 日志查看
AI服务器运行时会生成 `ai_server.log` 日志文件，包含详细的运行信息和错误记录。

## 开发说明

### 自定义虚拟形象
1. 将新的虚拟形象图片放在 `src/assets/mascot/` 目录下
2. 在 `AIAssistant.vue` 中更新图片导入路径
3. 调整CSS样式以适应新图片尺寸

### 扩展对话功能
1. 修改系统提示词以调整AI的专业领域
2. 添加新的对话功能（如语音输入、图片识别等）
3. 集成其他AI服务提供商

### 样式定制
1. 修改 `AIAssistant.vue` 中的CSS样式
2. 调整虚拟形象的位置和大小
3. 自定义对话界面的主题色彩

## 更新日志

### v1.0.0 (2024-01-01)
- 初始版本发布
- 集成DeepSeek API
- 实现基础对话功能
- 添加虚拟形象交互

## 技术支持

如有问题或建议，请联系开发团队或查看项目文档。 